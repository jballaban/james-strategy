- sensor:
  {%- for a in states.light | map(attribute='entity_id') | map('area_name') | unique | list %}
  - name: {{ a | title }} Lights On
    icon: mdi:lightbulb-on
    state: >
      {% raw %}{{ expand(area_entities('{% endraw %}{{ a }}'{% raw %}) | select('match', 'light')) | selectattr('state','eq','on') | list | count }}{% endraw %}
  {%- endfor -%}
  {%- for a in states.fan | map(attribute='entity_id') | map('area_name') | unique | list %}
  - name: {{ a | title }} Fans On
    icon: mdi:fan
    state: >
      {% raw %}{{ expand(area_entities('{% endraw %}{{ a }}'{% raw %}) | select('match', 'fan')) | selectattr('state','eq','on') | list | count }}{% endraw %}
  {%- endfor -%}
  {%- for a in states.cover | map(attribute='entity_id') | map('area_name') | unique | list %}
  - name: {{ a | title }} Covers On
    icon: mdi:blinds
    state: >
      {% raw %}{{ expand(area_entities('{% endraw %}{{ a }}'{% raw %}) | select('match', 'cover')) | selectattr('state','eq','open') | list | count }}{% endraw %}
  {%- endfor -%}